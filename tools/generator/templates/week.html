{% set additional_css = ["https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css"] %}
{% set additional_js = [
  "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js",
  "https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js",
  "https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/locale/fr.js",
  "https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.19.1/URI.min.js",
  "https://cdnjs.cloudflare.com/ajax/libs/history.js/1.8/bundled/html5/native.history.js",
  "https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js",
  "http://kflorence.github.io/jquery-deserialize/src/jquery.deserialize.js",
  "/week.js",
] %}
{% extends "base.html" %}

{% block contents %}
<div class="row d-lg-none">
  <div class="col">
    <div class="advertisement">
      <p>Publicité</p>
      <p><img class="img-fluid" src="/ads/468x60-banner.png" /></p>
    </div>
  </div>
</div>

<div class="row">
  <div class="col">
    <h1>Semaine du {{ week.days[0]|format_date }}</h1>

    <div class="script"><div class="row"><div class="col"><form id="display_settings">
      <div class="form-group">
        {% for tag in tags %}
        <div class="form-check form-check-inline display_checkbox" style="border-color: {{ tag.border_color }}; background-color: {{ tag.background_color }}">
          <input class="form-check-input" type="checkbox" name="tag" id="tag_{{ tag.slug }}" value="{{ tag.slug }}">
          <label class="form-check-label" for="tag_{{ tag.slug }}">{{ tag.title }}</label>
        </div>
        {% endfor %}
      </div>

      <div class="form-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="view_duration" id="view_duration_7" value="7" checked="checked">
          <label class="form-check-label" for="view_duration_7">1 semaine</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="view_duration" id="view_duration_3" value="3">
          <label class="form-check-label" for="view_duration_3">3 jours</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="view_duration" id="view_duration_1" value="1">
          <label class="form-check-label" for="view_duration_1">1 jour</label>
        </div>
      </div>

      <div class="form-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="view_type" id="view_type_basic" value="basic" checked="checked">
          <label class="form-check-label" for="view_type_basic">basique</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="view_type" id="view_type_list" value="list">
          <label class="form-check-label" for="view_type_list">liste</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="view_type" id="view_type_agenda" value="agenda">
          <label class="form-check-label" for="view_type_agenda">agenda</label>
        </div>
      </div>

      <div id="agenda_settings" class="form-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="overlap" id="overlap">
          <label class="form-check-label" for="overlap">événements se recouvrent</label>
        </div>
      </div>
    </form></div></div></div>

  {% macro previous_and_next_links() -%}
    <div class="previous_next_weeks_links"><div class="row">
      <div class="col">
        {%- if week.previous_week -%}
          <p class="text-right"><a class="tagged" href="{{ root_path }}/{{ city.slug }}/{{ week.previous_week.slug }}/">&lt; Semaine précédente</a></p>
        {%- endif -%}
      </div>
      <div class="col">
        {%- if week.next_week -%}
          <p><a class="tagged" href="{{ root_path }}/{{ city.slug }}/{{ week.next_week.slug }}/">Semaine suivante &gt;</a></p>
        {%- endif -%}
      </div>
    </div></div>

    <div class="previous_next_days_links script"><div class="row">
      <div class="col"><p class="text-right"><a class="tagged previous_day_link" href="{{ root_path }}/{{ city.slug }}/{{ week.slug }}/">&lt; Jour précédent</a></p></div>
      <div class="col"><p><a class="tagged next_day_link" href="{{ root_path }}/{{ city.slug }}/{{ week.slug }}/">Jour suivant &gt;</a></p></div>
    </div></div>
  {%- endmacro %}
    {{ previous_and_next_links() }}

    <div id="calendar">
      <noscript><dl>
  {% for day in week.days %}
        <dt>{{ day|format_date }}</dt>
    {% set day_events = events.get(day, []) %}
    {% if day_events %}
        <dd><ul>
      {% for event in day_events %}
          <li>{{ event.start|format_time }}, {{ event.location }}&nbsp;: {{ event.title }}</li>
      {% endfor %}
        </ul></dd>
    {% else %}
        <dd>Rien de prévu.</dd>
    {% endif %}
  {% endfor %}
      </dl></noscript>
    </div>

    {{ previous_and_next_links() }}
  </div>
  <div class="col-lg-3 col-xl-2 d-none d-lg-inline-block">
    <div class="advertisement">
      <p>Publicité</p>
      <p><img class="img-fluid" src="/ads/160x600-wide-skyscraper.png" /></p>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
  initialize_week({
    defaultDate: "{{ week.days[0] }}",
    all_events: [
      {% if week.next_week %}
        {% set days = week.days + week.next_week.days %}
      {% else %}
        {% set days = week.days %}
      {% endif %}
      {% for day in days %}
        {% for event in events.get(day, []) %}
        {
          title: "{{ event.location }}: {{ event.title }}",
          start: "{{ event.start }}",
          {% if event.end is defined %}
          end: "{{ event.end }}",
          {% endif %}
          tags: new Set([{% for tag in event.tags %}"{{ tag.slug }}"{% if not loop.last %}, {% endif %}{% endfor %}]),
          backgroundColor: "{{ event.tags[0].background_color }}",
          borderColor: "{{ event.tags[0].border_color }}",
        },
        {% endfor %}
      {% endfor %}
    ],
    days: {
      lundi: "{{ week.days[0] }}",
      mardi: "{{ week.days[1] }}",
      mercredi: "{{ week.days[2] }}",
      jeudi: "{{ week.days[3] }}",
      vendredi: "{{ week.days[4] }}",
      samedi: "{{ week.days[5] }}",
      dimanche: "{{ week.days[6] }}",
    },
    tag_names: {
    {% for tag in tags %}
      {{ tag.slug }}: "{{ tag.title|lower }}",
    {% endfor %}
    },
    week_paths: {
      {% if week.previous_week %}
      previous: "{{ root_path }}/{{ city.slug }}/{{ week.previous_week.slug }}/",
      {% endif %}
      current: "{{ root_path }}/{{ city.slug }}/{{ week.slug }}/",
      {% if week.next_week %}
      next: "{{ root_path }}/{{ city.slug }}/{{ week.next_week.slug }}/",
      {% endif %}
    }
  })
</script>
{% endblock %}
