<!doctype html>
<html lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="/admin/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css">

    <title>Splight - Reims</title>
  </head>
  <body>
    <div class="container">
      <div class="jumbotron">
        <h1 class="display-4"><a href="/admin/">Splight</a> - <a href="/admin/reims/">Reims</a></h1>
        <p class="lead">Votre agenda culturel à Reims et dans sa région.</p>
      </div>

      <noscript>
        <div class="row"><div class="col-md-3"></div><div class="col-md-6" style="border: red solid 3px">
          <p>Pour accéder à toutes les fonctionnalités de Splight (notamment l'affichage des calendriers filtrés par catégories), vous devez activer JavaScript.</p>
          <p>Voici les <a href="https://www.enable-javascript.com/fr/" target="_blank">instructions pour activer JavaScript dans votre navigateur Web</a>.</p>
        </div><div class="col-md-3"></div></div>
      </noscript>

      <div>
<div class="row d-lg-none">
  <div class="col">
    <div class="advertisement">
      <p>Publicité</p>
      <p><img class="img-fluid" src="/ads/468x60-banner.png" /></p>
    </div>
  </div>
</div>

<div class="row">
  <div class="col">
    <h1>Événements de la semaine du 2018/05/28</h1>

    <form id="display_tags" style="display: none">
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="display_tag_musique" data-tag="musique">
        <label class="form-check-label" for="display_tag_musique">Musique</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="display_tag_cinema" data-tag="cinema">
        <label class="form-check-label" for="display_tag_cinema">Cinéma</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="display_tag_theatre" data-tag="theatre">
        <label class="form-check-label" for="display_tag_theatre">Théâtre</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="display_tag_expositions" data-tag="expositions">
        <label class="form-check-label" for="display_tag_expositions">Expositions</label>
      </div>
    </form>

    <div class="row">
      <div class="col"><p class="text-right"><a class="tagged" href="/admin/reims/2018-21/">&lt; Semaine précédente</a></p></div>
      <div class="col"><p><a class="tagged" href="/admin/reims/2018-23/">Semaine suivante &gt;</a></p></div>
    </div>

    <div id="calendar">
      <noscript><dl>
        <dt>2018/05/28</dt>
        <dd><ul>
          <li>19h30, Lieu de test B&nbsp;: Artiste de test C (Genre Tutu)</li>
        </ul></dd>
        <dt>2018/05/29</dt>
        <dd><ul>
          <li>20h, Lieu de test C&nbsp;: Artiste de test A (Genre Toto)</li>
        </ul></dd>
        <dt>2018/05/30</dt>
        <dd>Rien de prévu.</dd>
        <dt>2018/05/31</dt>
        <dd>Rien de prévu.</dd>
        <dt>2018/06/01</dt>
        <dd><ul>
          <li>19h, Lieu de test A&nbsp;: Artiste de test B (Genre Titi)</li>
          <li>19h30, Lieu de test B&nbsp;: Artiste de test C (Genre Tutu)</li>
        </ul></dd>
        <dt>2018/06/02</dt>
        <dd>Rien de prévu.</dd>
        <dt>2018/06/03</dt>
        <dd><ul>
          <li>20h, Lieu de test C&nbsp;: Artiste de test A (Genre Toto)</li>
        </ul></dd>
      </dl></noscript>
    </div>

    <div class="row">
      <div class="col"><p class="text-right"><a class="tagged" href="/admin/reims/2018-21/">&lt; Semaine précédente</a></p></div>
      <div class="col"><p><a class="tagged" href="/admin/reims/2018-23/">Semaine suivante &gt;</a></p></div>
    </div>
  </div>
  <div class="col-lg-3 col-xl-2 d-none d-lg-inline-block">
    <div class="advertisement">
      <p>Publicité</p>
      <p><img class="img-fluid" src="/ads/160x600-wide-skyscraper.png" /></p>
    </div>
  </div>
</div>
      </div>

      <p>Copyright <a href="mailto:vincent@vincent-jacques.net">Vincent Jacques</a> 2018</p>
    </div>

    <div id="debug" style="margin-top: 50px; display: none"><ul>
      <li>Breakpoint:
        <span class="d-none d-sm-inline-block">xs</span>
        <strong class="d-inline-block d-sm-none">xs</strong>
        &lt; 576px &le;
        <span class="d-sm-none d-md-inline-block">sm</span>
        <strong class="d-none d-sm-inline-block d-md-none">sm</strong>
        &lt; 768px &le;
        <span class="d-md-none d-lg-inline-block">md</span>
        <strong class="d-none d-md-inline-block d-lg-none">md</strong>
        &lt; 992px &le;
        <span class="d-lg-none d-xl-inline-block">lg</span>
        <strong class="d-none d-lg-inline-block d-xl-none">lg</strong>
        &lt; 1200px &le;
        <span class="d-xl-none">xl</span>
        <strong class="d-none d-xl-inline-block">xl</strong>
      </li>
      <li>Container:
        <span class="d-inline-block d-sm-none">fluid</span>
        <span class="d-none d-sm-inline-block d-md-none">540px = 12 * 45px</span>
        <span class="d-none d-md-inline-block d-lg-none">720px = 12 * 60px</span>
        <span class="d-none d-lg-inline-block d-xl-none">960px = 12 * 80px</span>
        <span class="d-none d-xl-inline-block">1140px = 12 * 95px</span>
      </li>
      <li><a href="" onclick="location.href='http://www.responsinator.com/?url='+window.location.href; return false">Show in Responsinator</a></li>
    </ul></div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/locale/fr.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.19.1/URI.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/history.js/1.8/bundled/html5/native.history.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js" crossorigin="anonymous"></script>
    <script>
      $(function() {
        if(window.location.href.includes("?debug")) {
          $("#debug").show();
          $("a").each(function(a, b) {
            $(b).attr("href", $(b).attr("href") + "?debug");
          });
        }
      });
    </script>
<script>
  var tag_names = {
    musique: "musique",
    cinema: "cinéma",
    theatre: "théâtre",
    expositions: "expositions",
  };

  function get_tags_from_location() {
    var query = URI.parseQuery(URI.parse(window.location.href).query);
    var tags = [];
    for(var tag in tag_names) {
      if(_.has(query, tag)) {
        tags.push(tag);
      }
    }
    return tags;
  }

  function put_tags_in_location(tags) {
    tags = new Set(tags);
    function fix_query(data) {
      for(tag in tag_names) {
        if(tags.has(tag)) {
          data[tag] = null;
        } else {
          delete data[tag];
        }
      }
    }
    var uri = new URI(window.location.href);
    uri.search(fix_query);
    var title = "Splight";
    if(tags.length) {
      title = "Splight: " + tags.map(x => tag_names[x]).join(", ");
    }
    History.replaceState(null, title, uri.toString());
    window.document.title = title;
    $("a.tagged").each(function() {
      var a = $(this);
      var uri = new URI(a.prop("href"));
      uri.search(fix_query);
      a.prop("href", uri.toString());
    });
  }

  function get_tags_from_inputs() {
    var tags = [];
    $("#display_tags input").each(function() {
      var checkbox = $(this);
      if(checkbox.prop("checked")) {
        tags.push(checkbox.data("tag"));
      }
    });
    return tags;
  }

  function put_tags_in_inputs(tags) {
    $('#display_tags input').prop("checked", false);
    for(var tag of tags) {
      $('#display_tags input[data-tag="' + tag + '"]').prop("checked", true);
    }
  }

  var all_events = [
    {
      title: "Lieu de test B: Artiste de test C (Genre Tutu)",
      start: "2018-05-28 19:30:00",
      tags: new Set(["cinema"]),
    },
    {
      title: "Lieu de test C: Artiste de test A (Genre Toto)",
      start: "2018-05-29 20:00:00",
      tags: new Set(["theatre"]),
    },
    {
      title: "Lieu de test A: Artiste de test B (Genre Titi)",
      start: "2018-06-01 19:00:00",
      tags: new Set(["musique"]),
    },
    {
      title: "Lieu de test B: Artiste de test C (Genre Tutu)",
      start: "2018-06-01 19:30:00",
      tags: new Set(["cinema"]),
    },
    {
      title: "Lieu de test C: Artiste de test A (Genre Toto)",
      start: "2018-06-03 20:00:00",
      tags: new Set(["theatre"]),
    },
  ];

  function have_intersection(setA, setB) {
    for(var elem of setB) {
      if(setA.has(elem)) {
        return true;
      }
    }
    return false;
  }

  function eventSourceFunction(start, end, timezone, callback) {
    var displayed_tags = new Set(get_tags_from_inputs());
    callback(all_events.filter(event => have_intersection(event.tags, displayed_tags)));
  }

  $(function() {
    $("#display_tags").show();

    put_tags_in_inputs(get_tags_from_location());
    put_tags_in_location(get_tags_from_inputs());

    $("#calendar").fullCalendar({
      header: false,
      defaultDate: "2018-05-28",
      defaultView: "agendaWeek",
      locale: "fr",
      allDaySlot: false,
      eventLimit: true,
      minTime: "11:00:00",
      events: eventSourceFunction,
    });

    var calendar = $('#calendar').fullCalendar('getCalendar');

    $("#display_tags input").on("change", function() {
      put_tags_in_location(get_tags_from_inputs());
      calendar.refetchEventSources(calendar.getEventSources());
    });
  });
</script>
  </body>
</html>
